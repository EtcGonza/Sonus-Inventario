import{a as c}from"./chunk-E6WIJYGD.js";import{a as d}from"./chunk-GLYNVZRA.js";import{C as s,E as r,I as p,M as o}from"./chunk-6DWSO5LZ.js";var l=class i{constructor(t,e){this.repository=t;this.eventRepo=e}getAll(){return this.repository.getAll()}getById(t){return this.repository.getById(t)}create(t){return this.repository.create(t).pipe(r(e=>{e.cantidad!==0&&this.eventRepo.create({entity_type:"Material",entity_id:e.id,tipo:"entrada",cantidad:e.cantidad,nota:"Stock inicial"}).subscribe()}))}update(t,e){return this.repository.getById(t).pipe(s(a=>{if(!a)throw new Error("Material not found");let n=a.cantidad;return this.repository.update(t,e).pipe(r(b=>{if(e.cantidad!==void 0&&e.cantidad!==n){let y=e.cantidad-n;this.eventRepo.create({entity_id:t,entity_type:"Material",tipo:"ajuste",cantidad:y,nota:"Actualizaci\xF3n manual"}).subscribe()}e.estado&&e.estado!==a.estado&&this.eventRepo.create({entity_id:t,entity_type:"Material",tipo:"ajuste",cantidad:0,nota:`Estado cambiado a: ${e.estado}`}).subscribe()}))}))}delete(t){return this.repository.delete(t)}getHistory(t){return this.eventRepo.getByMaterialId(t)}static \u0275fac=function(e){return new(e||i)(o(d),o(c))};static \u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})};export{l as a};
