import{a as _e,b as Ce}from"./chunk-ZGM2GPVE.js";import{a as q}from"./chunk-YALXNCVK.js";import{b as B,d as $,e as E,h as I}from"./chunk-UHXNRV65.js";import{a as Se}from"./chunk-BBU5S45I.js";import"./chunk-RR733YBY.js";import{a as V,b as X,c as j,d as ue,e as Z,f as fe,g as xe,h as ve,k as be,l as ge,m as H,n as G,o as U,p as he,q as ye,r as Y}from"./chunk-HPRGVJKF.js";import{$a as se,B as J,C as b,E as K,Ea as y,Hb as ce,I as ne,Ib as P,Ja as le,Jb as me,Kb as A,Lb as w,M as Q,Ra as L,S as k,T as F,Ta as N,U as ae,V as de,Va as S,Wa as _,Xa as s,Ya as r,Za as i,_a as g,a as ie,ab as h,bb as O,fb as M,gb as o,hb as f,ib as c,j as R,kb as pe,n as re,nb as C,o as oe,ob as m,pb as x,qb as D,ra as a,za as p}from"./chunk-6DWSO5LZ.js";var v=class n{constructor(t,e){this.repository=t;this.historyRepo=e}getAll(){return this.repository.getAll()}getById(t){return this.repository.getById(t)}create(t){return this.repository.create(t).pipe(K(e=>{this.historyRepo.create({entity_id:e.id,campo_modificado:"CREATION",valor_nuevo:"Created",nota:"Producto creado"}).subscribe()}))}update(t,e){return this.repository.getById(t).pipe(b(d=>{if(!d)throw new Error("Product not found");let l=ie({},d);return this.repository.update(t,e).pipe(K(u=>{this.logChange(t,"nombre",l.nombre,u.nombre),this.logChange(t,"receta_id",l.receta_id,u.receta_id),this.logChange(t,"precio",l.precio,u.precio),this.logChange(t,"nota",l.nota,u.nota),this.logChange(t,"estado",l.estado,u.estado)}))}))}delete(t){return this.repository.delete(t)}getHistory(t){return this.historyRepo.getByProductId(t)}logChange(t,e,d,l){if(d!==l){if(d==null&&l==null)return;this.historyRepo.create({entity_id:t,campo_modificado:e,valor_anterior:d,valor_nuevo:l}).subscribe()}}static \u0275fac=function(e){return new(e||n)(Q(_e),Q(Ce))};static \u0275prov=ne({token:n,factory:n.\u0275fac,providedIn:"root"})};var Pe=n=>[n],Fe=n=>[n,"edit"],Oe=(n,t)=>t.id;function De(n,t){if(n&1&&(r(0,"div",29),o(1),i()),n&2){let e=O().$implicit;a(),f(e.nota)}}function Te(n,t){if(n&1){let e=se();r(0,"tr",25),h("click",function(){let l=k(e).$implicit,u=O();return F(u.goToDetail(l.id))}),r(1,"td",26)(2,"div",27)(3,"a",28),h("click",function(l){return k(e),F(l.stopPropagation())}),o(4),i()(),L(5,De,2,1,"div",29),i(),r(6,"td",26)(7,"div",30),o(8),m(9,"currency"),i()(),r(10,"td",26)(11,"span",31),o(12),m(13,"statusLabel"),i()(),r(14,"td",32)(15,"a",33),h("click",function(l){return k(e),F(l.stopPropagation())}),o(16,"Detalle"),i(),r(17,"a",34),h("click",function(l){return k(e),F(l.stopPropagation())}),o(18,"Editar"),i()()()}if(n&2){let e=t.$implicit;a(3),s("routerLink",C(24,Pe,e.id)),a(),f(e.nombre),a(),N(e.nota?5:-1),a(3),f(D(9,19,e.precio,"USD")),a(3),M("bg-green-100",e.estado==="active")("text-green-800",e.estado==="active")("bg-yellow-100",e.estado==="draft")("text-yellow-800",e.estado==="draft")("bg-gray-100",e.estado==="disabled")("text-gray-800",e.estado==="disabled"),a(),c(" ",x(13,22,e.estado)," "),a(3),s("routerLink",C(26,Pe,e.id)),a(2),s("routerLink",C(28,Fe,e.id))}}function Le(n,t){n&1&&(r(0,"tr")(1,"td",35),o(2," No hay productos registrados. "),i()())}var z=class n{constructor(t,e){this.productService=t;this.router=e}products$;filteredProducts$;searchControl=new Z("",{nonNullable:!0});statusControl=new Z("",{nonNullable:!0});ngOnInit(){this.products$=this.productService.getAll(),this.filteredProducts$=oe([this.products$,this.searchControl.valueChanges.pipe(J("")),this.statusControl.valueChanges.pipe(J(""))]).pipe(re(([t,e,d])=>t.filter(l=>{let u=l.nombre.toLowerCase().includes(e.toLowerCase()),Re=d===""||l.estado===d;return u&&Re})))}goToDetail(t){this.router.navigate(["/products",t])}static \u0275fac=function(e){return new(e||n)(p(v),p($))};static \u0275cmp=y({type:n,selectors:[["app-product-list"]],decls:42,vars:5,consts:[[1,"container","mx-auto","p-6"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-3xl","font-bold","text-slate-800"],["routerLink","new",1,"bg-primary-600","hover:bg-primary-700","text-white","font-medium","py-2","px-4","rounded-lg","transition-colors","duration-200"],[1,"bg-white","shadow-md","rounded-lg","overflow-hidden","border","border-slate-200"],[1,"p-4","bg-slate-50","border-b","border-slate-200","flex","flex-wrap","gap-4"],[1,"flex-grow","max-w-sm"],[1,"sr-only"],[1,"relative"],[1,"absolute","inset-y-0","left-0","pl-3","flex","items-center","pointer-events-none"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-5","w-5","text-slate-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["type","text","placeholder","Buscar por nombre...",1,"block","w-full","pl-10","pr-3","py-2","border","border-slate-300","rounded-md","leading-5","bg-white","placeholder-slate-500","focus:outline-none","focus:ring-1","focus:ring-primary-500","focus:border-primary-500","sm:text-sm",3,"formControl"],[1,"w-48"],[1,"block","w-full","py-2","px-3","border","border-slate-300","bg-white","rounded-md","shadow-sm","focus:outline-none","focus:ring-primary-500","focus:border-primary-500","sm:text-sm",3,"formControl"],["value",""],["value","active"],["value","draft"],["value","disabled"],[1,"min-w-full","divide-y","divide-slate-200"],[1,"bg-slate-50"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-slate-500","uppercase","tracking-wider"],["scope","col",1,"px-6","py-3","text-right","text-xs","font-medium","text-slate-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-slate-200"],[1,"hover:bg-slate-50","transition-colors","duration-150","cursor-pointer"],[1,"hover:bg-slate-50","transition-colors","duration-150","cursor-pointer",3,"click"],[1,"px-6","py-4","whitespace-nowrap"],[1,"text-sm","font-medium","text-slate-900"],[1,"hover:text-primary-600","hover:underline",3,"click","routerLink"],[1,"text-xs","text-slate-500"],[1,"text-sm","text-slate-900"],[1,"px-2","inline-flex","text-xs","leading-5","font-semibold","rounded-full"],[1,"px-6","py-4","whitespace-nowrap","text-right","text-sm","font-medium"],[1,"text-primary-600","hover:text-primary-900","mr-4",3,"click","routerLink"],[1,"text-slate-600","hover:text-slate-900","mr-4",3,"click","routerLink"],["colspan","5",1,"px-6","py-4","text-center","text-slate-500"]],template:function(e,d){e&1&&(r(0,"div",0)(1,"div",1)(2,"h1",2),o(3,"Productos"),i(),r(4,"a",3),o(5," + Nuevo Producto "),i()(),r(6,"div",4)(7,"div",5)(8,"div",6)(9,"label",7),o(10,"Buscar producto"),i(),r(11,"div",8)(12,"div",9),ae(),r(13,"svg",10),g(14,"path",11),i()(),de(),g(15,"input",12),i()(),r(16,"div",13)(17,"select",14)(18,"option",15),o(19,"Todos los estados"),i(),r(20,"option",16),o(21,"Activo"),i(),r(22,"option",17),o(23,"Borrador"),i(),r(24,"option",18),o(25,"Deshabilitado"),i()()()(),r(26,"table",19)(27,"thead",20)(28,"tr")(29,"th",21),o(30,"Nombre"),i(),r(31,"th",21),o(32,"Precio"),i(),r(33,"th",21),o(34,"Estado"),i(),r(35,"th",22),o(36,"Acciones"),i()()(),r(37,"tbody",23),S(38,Te,19,30,"tr",24,Oe,!1,Le,3,0,"tr"),m(41,"async"),i()()()()),e&2&&(a(15),s("formControl",d.searchControl),a(2),s("formControl",d.statusControl),a(21),_(x(41,3,d.filteredProducts$)))},dependencies:[w,I,E,Y,G,U,V,H,j,ve,P,A,q],encapsulation:2})};var Ne=(n,t)=>t.id;function Me(n,t){if(n&1&&(r(0,"option",12),o(1),i()),n&2){let e=t.$implicit;s("value",e.id),a(),f(e.nombre)}}function Ae(n,t){n&1&&(r(0,"div")(1,"label",21),o(2,"Estado"),i(),r(3,"select",22)(4,"option",23),o(5,"Borrador"),i(),r(6,"option",24),o(7,"Activo"),i(),r(8,"option",25),o(9,"Deshabilitado"),i()()())}var T=class n{constructor(t,e,d,l,u){this.fb=t;this.productService=e;this.recipeService=d;this.router=l;this.route=u;this.productForm=this.fb.group({nombre:["",X.required],receta_id:[null],precio:[0,[X.min(0)]],nota:[""],estado:["draft"]})}productForm;isEditing=!1;productId=null;recipes$;ngOnInit(){this.recipes$=this.recipeService.getAll(),this.route.paramMap.pipe(b(t=>{let e=t.get("id");return e?(this.isEditing=!0,this.productId=e,this.productService.getById(e)):R(null)})).subscribe(t=>{t&&this.productForm.patchValue({nombre:t.nombre,receta_id:t.receta_id,precio:t.precio,nota:t.nota,estado:t.estado})})}onSubmit(){if(this.productForm.invalid)return;let t=this.productForm.value;t.receta_id||(t.receta_id=null),this.isEditing&&this.productId?this.productService.update(this.productId,t).subscribe(()=>{this.router.navigate(["/products"])}):this.productService.create(t).subscribe(()=>{this.router.navigate(["/products"])})}static \u0275fac=function(e){return new(e||n)(p(ye),p(v),p(Se),p($),p(B))};static \u0275cmp=y({type:n,selectors:[["app-product-form"]],decls:38,vars:8,consts:[[1,"container","mx-auto","p-6","max-w-2xl"],[1,"mb-6"],["routerLink","/products",1,"text-primary-600","hover:text-primary-800","mb-2","inline-block"],[1,"text-3xl","font-bold","text-slate-800"],[1,"bg-white","shadow-md","rounded-lg","p-6","border","border-slate-200"],[3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","gap-6"],["for","nombre",1,"block","text-sm","font-medium","text-slate-700","mb-1"],["type","text","id","nombre","formControlName","nombre",1,"w-full","rounded-md","border-slate-300","shadow-sm","focus:border-primary-500","focus:ring-primary-500","sm:text-sm","p-2","border"],["for","receta_id",1,"block","text-sm","font-medium","text-slate-700","mb-1"],["id","receta_id","formControlName","receta_id",1,"w-full","rounded-md","border-slate-300","shadow-sm","focus:border-primary-500","focus:ring-primary-500","sm:text-sm","p-2","border"],[3,"ngValue"],[3,"value"],[1,"text-xs","text-slate-500","mt-1"],["for","precio",1,"block","text-sm","font-medium","text-slate-700","mb-1"],["type","number","id","precio","formControlName","precio","min","0","step","0.01",1,"w-full","rounded-md","border-slate-300","shadow-sm","focus:border-primary-500","focus:ring-primary-500","sm:text-sm","p-2","border"],["for","nota",1,"block","text-sm","font-medium","text-slate-700","mb-1"],["id","nota","formControlName","nota","rows","3",1,"w-full","rounded-md","border-slate-300","shadow-sm","focus:border-primary-500","focus:ring-primary-500","sm:text-sm","p-2","border"],[1,"mt-8","flex","justify-end","space-x-3"],["routerLink","/products",1,"px-4","py-2","border","border-slate-300","rounded-md","text-slate-700","hover:bg-slate-50","transition-colors"],["type","submit",1,"px-4","py-2","bg-primary-600","text-white","rounded-md","hover:bg-primary-700","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],["for","estado",1,"block","text-sm","font-medium","text-slate-700","mb-1"],["id","estado","formControlName","estado",1,"w-full","rounded-md","border-slate-300","shadow-sm","focus:border-primary-500","focus:ring-primary-500","sm:text-sm","p-2","border"],["value","draft"],["value","active"],["value","disabled"]],template:function(e,d){e&1&&(r(0,"div",0)(1,"div",1)(2,"a",2),o(3,"\u2190 Volver a la lista"),i(),r(4,"h1",3),o(5),i()(),r(6,"div",4)(7,"form",5),h("ngSubmit",function(){return d.onSubmit()}),r(8,"div",6)(9,"div")(10,"label",7),o(11,"Nombre *"),i(),g(12,"input",8),i(),r(13,"div")(14,"label",9),o(15,"Receta Vinculada"),i(),r(16,"select",10)(17,"option",11),o(18,"--- Sin Receta ---"),i(),S(19,Me,2,2,"option",12,Ne),m(21,"async"),i(),r(22,"p",13),o(23,"Si no se selecciona receta, el producto quedar\xE1 en borrador."),i()(),r(24,"div")(25,"label",14),o(26,"Precio"),i(),g(27,"input",15),i(),r(28,"div")(29,"label",16),o(30,"Nota"),i(),g(31,"textarea",17),i(),L(32,Ae,10,0,"div"),i(),r(33,"div",18)(34,"a",19),o(35,"Cancelar"),i(),r(36,"button",20),o(37),i()()()()()),e&2&&(a(5),f(d.isEditing?"Editar Producto":"Nuevo Producto"),a(2),s("formGroup",d.productForm),a(10),s("ngValue",null),a(2),_(x(21,6,d.recipes$)),a(13),N(d.isEditing?32:-1),a(4),s("disabled",d.productForm.invalid),a(),c(" ",d.isEditing?"Actualizar":"Guardar"," "))},dependencies:[w,Y,fe,G,U,V,xe,H,j,ue,he,ge,be,I,E,P],encapsulation:2})};var Be=n=>["/products",n,"edit"],$e=(n,t)=>t.id;function Ve(n,t){if(n&1&&(r(0,"tr")(1,"td",21),o(2),m(3,"date"),i(),r(4,"td",22),o(5),i(),r(6,"td",23),o(7),i(),r(8,"td",24),o(9),i()()),n&2){let e=t.$implicit;a(2),c(" ",D(3,4,e.timestamp,"short")," "),a(3),c(" ",e.campo_modificado," "),a(2),c(" ",e.valor_anterior!==void 0?e.valor_anterior:"-"," "),a(2),c(" ",e.valor_nuevo!==void 0?e.valor_nuevo:"-"," ")}}function je(n,t){n&1&&(r(0,"tr")(1,"td",25),o(2,"Sin cambios registrados."),i()())}function He(n,t){if(n&1&&(r(0,"div",1)(1,"div",2)(2,"div")(3,"a",3),o(4,"\u2190 Volver a la lista"),i(),r(5,"h1",4),o(6),i(),r(7,"span",5),o(8),i()(),r(9,"div",6)(10,"a",7),o(11,"Editar"),i()()(),r(12,"div",8)(13,"div",9)(14,"h3",10),o(15,"Precio"),i(),r(16,"p",11),o(17),m(18,"currency"),i()(),r(19,"div",9)(20,"h3",10),o(21,"Receta Vinculada"),i(),r(22,"p",12),o(23),i()(),r(24,"div",9)(25,"h3",10),o(26,"Estado"),i(),r(27,"span",13),o(28),m(29,"statusLabel"),i()()(),r(30,"div",14)(31,"div",15)(32,"h2",16),o(33,"Historial de Cambios"),i()(),r(34,"table",17)(35,"thead",18)(36,"tr")(37,"th",19),o(38,"Fecha"),i(),r(39,"th",19),o(40,"Campo"),i(),r(41,"th",19),o(42,"Valor Anterior"),i(),r(43,"th",19),o(44,"Valor Nuevo"),i()()(),r(45,"tbody",20),S(46,Ve,10,7,"tr",null,$e,!1,je,3,0,"tr"),m(49,"async"),i()()()()),n&2){let e=t.ngIf,d=O();a(6),f(e.nombre),a(2),c("ID: ",e.id),a(2),s("routerLink",C(28,Be,e.id)),a(7),f(D(18,21,e.precio,"USD")),a(5),s("title",pe(e.receta_id)),a(),c(" ",e.receta_id?"S\xED ("+e.receta_id.substring(0,8)+"...)":"No"," "),a(4),M("bg-green-100",e.estado==="active")("text-green-800",e.estado==="active")("bg-yellow-100",e.estado==="draft")("text-yellow-800",e.estado==="draft")("bg-gray-100",e.estado==="disabled")("text-gray-800",e.estado==="disabled"),a(),c(" ",x(29,24,e.estado)," "),a(18),_(x(49,26,d.history$))}}var W=class n{constructor(t,e){this.route=t;this.productService=e}product$;history$;ngOnInit(){this.product$=this.route.paramMap.pipe(b(t=>{let e=t.get("id");return e?this.productService.getById(e):R(void 0)})),this.history$=this.route.paramMap.pipe(b(t=>{let e=t.get("id");return e?this.productService.getHistory(e):R([])}))}static \u0275fac=function(e){return new(e||n)(p(B),p(v))};static \u0275cmp=y({type:n,selectors:[["app-product-detail"]],decls:2,vars:3,consts:[["class","container mx-auto p-6 max-w-4xl",4,"ngIf"],[1,"container","mx-auto","p-6","max-w-4xl"],[1,"mb-6","flex","justify-between","items-center"],["routerLink","/products",1,"text-primary-600","hover:text-primary-800","mb-2","inline-block"],[1,"text-3xl","font-bold","text-slate-800"],[1,"text-sm","text-slate-500"],[1,"space-x-3"],[1,"bg-primary-600","text-white","px-4","py-2","rounded-md","hover:bg-primary-700","transition",3,"routerLink"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","mb-8"],[1,"bg-white","p-6","rounded-lg","shadow","border","border-slate-200"],[1,"text-xs","font-bold","text-slate-500","uppercase","mb-1"],[1,"text-2xl","text-slate-900"],[1,"text-lg","text-slate-900","truncate",3,"title"],[1,"px-2","inline-flex","text-xs","leading-5","font-semibold","rounded-full"],[1,"bg-white","rounded-lg","shadow","border","border-slate-200","overflow-hidden"],[1,"px-6","py-4","border-b","border-slate-200","bg-slate-50"],[1,"text-lg","font-bold","text-slate-800"],[1,"min-w-full","divide-y","divide-slate-200"],[1,"bg-slate-50"],[1,"px-6","py-3","text-left","text-xs","font-medium","text-slate-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-slate-200"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-slate-500"],[1,"px-6","py-4","whitespace-nowrap","text-sm","font-medium","text-slate-900"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-slate-500","text-red-500"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-slate-500","text-green-600"],["colspan","4",1,"px-6","py-4","text-center","text-slate-500"]],template:function(e,d){e&1&&(le(0,He,50,30,"div",0),m(1,"async")),e&2&&s("ngIf",x(1,1,d.product$))},dependencies:[w,ce,I,E,P,A,me,q],encapsulation:2})};var It=[{path:"",component:z},{path:"new",component:T},{path:":id/edit",component:T},{path:":id",component:W}];export{It as PRODUCTS_ROUTES};
