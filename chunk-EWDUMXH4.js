import{a as pe}from"./chunk-GLYNVZRA.js";import{a as xe}from"./chunk-BBU5S45I.js";import{a as ue}from"./chunk-RR733YBY.js";import{a as K,b as k,c as X,d as Z,f as ee,g as te,i as ie,j as re,k as ae,l as ne,m as le,n as oe,o as de,p as se,q as me,r as ce}from"./chunk-HPRGVJKF.js";import{$a as Q,Ea as W,I as L,Ib as Y,Lb as J,M as P,Ra as y,S as H,Sa as U,T as z,Ta as E,U as C,Ua as V,V as w,Va as f,Wa as v,Xa as B,Ya as i,Za as r,_a as g,ab as M,bb as _,fb as q,g as D,gb as n,hb as u,ib as F,jb as N,n as S,o as A,ob as $,pb as j,ra as o,za as R}from"./chunk-6DWSO5LZ.js";var T=class a{constructor(t,e){this.materialRepo=t;this.recipeRepo=e}getBuildableOverview(){return A([this.recipeRepo.getAll(),this.materialRepo.getAll()]).pipe(S(([t,e])=>t.filter(l=>l.estado==="active").map(l=>this.calculateForRecipe(l,e))))}simulateOrder(t){return A([this.recipeRepo.getAll(),this.materialRepo.getAll()]).pipe(S(([e,l])=>{let d=new Map,p=[];for(let m of t){let b=e.find(s=>s.id===m.recipeId);if(!b)continue;let c=!0;for(let s of b.materiales){let I=l.find(fe=>fe.id===s.material_id),G=s.cantidad_requerida*m.quantity,be=d.get(s.material_id)||0;d.set(s.material_id,be+G),(!I||I.cantidad<G)&&(c=!1)}p.push({recipeName:b.nombre,quantity:m.quantity,canBuild:c})}let x=[],h=!0;return d.forEach((m,b)=>{let c=l.find(I=>I.id===b),s=c?c.cantidad:0;s<m&&(h=!1,x.push({materialId:b,materialName:c?c.nombre:"Material desconocido",needed:m,available:s,missing:m-s,unit:c?c.unidad:""}))}),{requestedItems:p,isWholeOrderPossible:h,missingMaterials:x}}))}calculateForRecipe(t,e){let l=1/0,d=null;if(!t.materiales||t.materiales.length===0)return{recipeId:t.id,recipeName:t.nombre,maxBuildable:0,limitingMaterialName:"No materials defined"};for(let p of t.materiales){let x=e.find(m=>m.id===p.material_id);if(!x){l=0,d="Unknown Material";break}if(p.cantidad_requerida<=0)continue;let h=Math.floor(x.cantidad/p.cantidad_requerida);h<l&&(l=h,d=x.nombre)}return l===1/0&&(l=0),{recipeId:t.id,recipeName:t.nombre,maxBuildable:l,limitingMaterialName:d||void 0}}static \u0275fac=function(e){return new(e||a)(P(pe),P(ue))};static \u0275prov=L({token:a,factory:a.\u0275fac,providedIn:"root"})};var _e=(a,t)=>t.recipeId,he=(a,t)=>t.id,Se=(a,t)=>t.materialId;function Ce(a,t){if(a&1&&(i(0,"div",26),n(1," Limitado por: "),i(2,"strong"),n(3),r(),n(4," (stock insuficiente) "),r()),a&2){let e=_().$implicit;o(3),u(e.limitingMaterialName)}}function ye(a,t){if(a&1&&(i(0,"div",27),n(1),r()),a&2){let e=_().$implicit;o(),F(" Limitado por: ",e.limitingMaterialName," ")}}function Ee(a,t){if(a&1&&(i(0,"div",5)(1,"h3",21),n(2),r(),i(3,"div",22)(4,"div")(5,"span",23),n(6,"Disponible para armar"),r(),i(7,"span",24),n(8),r(),i(9,"span",25),n(10,"unidades"),r()()(),y(11,Ce,5,1,"div",26)(12,ye,2,1,"div",27),r()),a&2){let e=t.$implicit;o(2),u(e.recipeName),o(6),u(e.maxBuildable),o(3),E(e.maxBuildable===0&&e.limitingMaterialName?11:e.limitingMaterialName?12:-1)}}function Be(a,t){a&1&&(i(0,"div",6),n(1," No hay recetas activas o datos suficientes para calcular. "),r())}function Ie(a,t){if(a&1&&(i(0,"option",32),n(1),r()),a&2){let e=t.$implicit;B("value",e.id),o(),u(e.nombre)}}function we(a,t){if(a&1){let e=Q();i(0,"div",14)(1,"div",28)(2,"label",29),n(3,"Producto"),r(),i(4,"select",30)(5,"option",31),n(6,"Seleccionar..."),r(),f(7,Ie,2,2,"option",32,he),r(),i(9,"label",33),n(10,"Cantidad"),r(),g(11,"input",34),r(),i(12,"button",35),M("click",function(){let d=H(e).$index,p=_();return z(p.removeItem(d))}),C(),i(13,"svg",36),g(14,"path",37),r()()()}if(a&2){let e=t.$index,l=_();B("formGroupName",e),o(7),v(l.getFilteredRecipes(e))}}function Re(a,t){a&1&&(i(0,"span",44),C(),i(1,"svg",45),g(2,"path",46),r()(),w(),i(3,"h3",47),n(4,"\xA1Pedido posible! Hay stock suficiente."),r())}function Me(a,t){a&1&&(i(0,"span",48),C(),i(1,"svg",45),g(2,"path",49),r()(),w(),i(3,"h3",50),n(4,"Stock insuficiente para el pedido completo."),r())}function Fe(a,t){if(a&1&&(i(0,"div",43)(1,"div")(2,"span",51),n(3),r(),i(4,"span",52),n(5),r()(),i(6,"span",53),n(7),r()()),a&2){let e=t.$implicit;o(3),u(e.recipeName),o(2),F("Cantidad: ",e.quantity),o(),q("bg-green-100",e.canBuild)("text-green-800",e.canBuild)("bg-red-100",!e.canBuild)("text-red-800",!e.canBuild),o(),F(" ",e.canBuild?"Cubierto":"Insuficiente"," ")}}function Ne(a,t){if(a&1&&(i(0,"tr")(1,"td",61),n(2),r(),i(3,"td",62),n(4),r(),i(5,"td",62),n(6),r(),i(7,"td",63),n(8),r()()),a&2){let e=t.$implicit;o(2),u(e.materialName),o(2),N("",e.needed," ",e.unit),o(2),N("",e.available," ",e.unit),o(2),N("",e.missing," ",e.unit)}}function ke(a,t){if(a&1&&(i(0,"div")(1,"h4",41),n(2,"Materiales Faltantes (Consolidado)"),r(),i(3,"div",54)(4,"table",55)(5,"thead",56)(6,"tr")(7,"th",57),n(8,"Material"),r(),i(9,"th",58),n(10,"Necesario"),r(),i(11,"th",58),n(12,"Disponible"),r(),i(13,"th",59),n(14,"Faltante"),r()()(),i(15,"tbody",60),f(16,Ne,9,7,"tr",null,Se),r()()()()),a&2){let e=_();o(16),v(e.missingMaterials)}}function Te(a,t){if(a&1&&(i(0,"div",19)(1,"div",38)(2,"div",39),y(3,Re,5,0)(4,Me,5,0),r()(),i(5,"div",40)(6,"div")(7,"h4",41),n(8,"Desglose por Producto"),r(),i(9,"div",42),f(10,Fe,8,11,"div",43,V),r()(),y(12,ke,18,0,"div"),r()()),a&2){let e=t;o(),q("bg-green-50",e.isWholeOrderPossible)("bg-red-50",!e.isWholeOrderPossible),o(2),E(e.isWholeOrderPossible?3:4),o(7),v(e.requestedItems),o(2),E(e.isWholeOrderPossible?-1:12)}}function Oe(a,t){a&1&&(i(0,"div",20),C(),i(1,"svg",64),g(2,"path",65),r(),w(),i(3,"p",66),n(4,'Configura un pedido y haz clic en "Simular" para ver los resultados.'),r()())}var O=class a{constructor(t,e,l){this.buildService=t;this.recipeService=e;this.fb=l;this.simulationForm=this.fb.group({items:this.fb.array([])})}results$;allRecipes=[];simulationForm;simulationResult$=new D(null);ngOnInit(){this.results$=this.buildService.getBuildableOverview(),this.recipeService.getAll().pipe(S(t=>t.filter(e=>e.estado==="active"))).subscribe(t=>{this.allRecipes=t}),this.addItem()}get items(){return this.simulationForm.get("items")}getFilteredRecipes(t){let e=this.items.value.map((l,d)=>d!==t?l.recipeId:null).filter(l=>l!==null&&l!=="");return this.allRecipes.filter(l=>!e.includes(l.id))}addItem(){let t=this.fb.group({recipeId:["",k.required],quantity:[1,[k.required,k.min(1)]]});this.items.push(t)}removeItem(t){this.items.removeAt(t)}onSimulate(){if(this.simulationForm.invalid)return;let t=this.simulationForm.value.items;this.buildService.simulateOrder(t).subscribe(e=>{this.simulationResult$.next(e)})}static \u0275fac=function(e){return new(e||a)(R(T),R(xe),R(me))};static \u0275cmp=W({type:a,selectors:[["app-build-calculator"]],decls:34,vars:8,consts:[[1,"container","mx-auto","p-6","space-y-12"],[1,"mb-6"],[1,"text-3xl","font-bold","text-slate-800"],[1,"text-slate-600","mt-2"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[1,"bg-white","shadow","rounded-lg","p-6","border","border-slate-200","hover:shadow-md","transition-shadow"],[1,"col-span-full","text-center","py-12","bg-slate-50","rounded-lg","text-slate-500","border","border-dashed","border-slate-300"],[1,"border-t","border-slate-200","pt-12"],[1,"text-2xl","font-bold","text-slate-800","text-primary-700"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-8"],[1,"lg:col-span-1","space-y-6"],[1,"bg-white","shadow","rounded-lg","p-6","border","border-slate-200"],[3,"ngSubmit","formGroup"],["formArrayName","items",1,"space-y-4"],[1,"flex","items-start","gap-2","pb-4","border-b","border-slate-100","last:border-0","last:pb-0",3,"formGroupName"],[1,"mt-6","flex","flex-col","gap-3"],["type","button",1,"w-full","py-2","px-4","border","border-primary-600","text-primary-600","rounded-md","hover:bg-primary-50","transition-colors","text-sm","font-medium",3,"click"],["type","submit",1,"w-full","py-2","px-4","bg-primary-600","text-white","rounded-md","hover:bg-primary-700","transition-colors","shadow-sm","disabled:opacity-50","font-bold",3,"disabled"],[1,"lg:col-span-2","space-y-6"],[1,"bg-white","shadow","rounded-lg","overflow-hidden","border","border-slate-200"],[1,"h-full","flex","flex-col","items-center","justify-center","py-20","bg-slate-50","rounded-lg","border-2","border-dashed","border-slate-200","text-slate-400"],[1,"text-lg","font-semibold","text-slate-800","mb-2"],[1,"flex","items-end","justify-between"],[1,"block","text-sm","text-slate-500"],[1,"text-4xl","font-bold","text-primary-600"],[1,"text-sm","text-slate-400","ml-1"],[1,"mt-4","text-xs","text-red-500","bg-red-50","p-2","rounded"],[1,"mt-4","text-xs","text-slate-500"],[1,"flex-grow","space-y-2"],[1,"block","text-xs","font-semibold","text-slate-500","uppercase"],["formControlName","recipeId",1,"w-full","rounded-md","border-slate-300","shadow-sm","focus:border-primary-500","focus:ring-primary-500","sm:text-sm","p-2","border"],["value",""],[3,"value"],[1,"block","text-xs","font-semibold","text-slate-500","uppercase","mt-2"],["type","number","formControlName","quantity","min","1",1,"w-full","rounded-md","border-slate-300","shadow-sm","focus:border-primary-500","focus:ring-primary-500","sm:text-sm","p-2","border"],["type","button","title","Quitar",1,"mt-6","text-red-500","hover:text-red-700","p-2",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5"],["fill-rule","evenodd","d","M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule","evenodd"],[1,"p-4","border-b","border-slate-200"],[1,"flex","items-center","gap-2"],[1,"p-6","space-y-8"],[1,"text-sm","font-semibold","text-slate-500","uppercase","mb-4","tracking-wider"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-4"],[1,"flex","items-center","justify-between","p-3","rounded-md","bg-slate-50","border","border-slate-200"],[1,"text-green-600"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-lg","font-bold","text-green-800"],[1,"text-red-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-lg","font-bold","text-red-800"],[1,"block","font-medium","text-slate-800"],[1,"text-xs","text-slate-500"],[1,"px-2","py-1","text-xs","font-bold","rounded"],[1,"overflow-x-auto","border","border-slate-200","rounded-lg"],[1,"min-w-full","divide-y","divide-slate-200"],[1,"bg-slate-50"],[1,"px-4","py-2","text-left","text-xs","font-bold","text-slate-500","uppercase"],[1,"px-4","py-2","text-center","text-xs","font-bold","text-slate-500","uppercase"],[1,"px-4","py-2","text-right","text-xs","font-bold","text-slate-500","uppercase"],[1,"bg-white","divide-y","divide-slate-100"],[1,"px-4","py-3","text-sm","font-medium","text-slate-900"],[1,"px-4","py-3","text-sm","text-slate-600","text-center"],[1,"px-4","py-3","text-sm","font-bold","text-red-600","text-right"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-16","w-16","mb-4","opacity-20"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 002-2h-2a2 2 0 002 2"],[1,"text-lg"]],template:function(e,l){if(e&1&&(i(0,"div",0)(1,"section")(2,"div",1)(3,"h1",2),n(4,"\xBFQu\xE9 puedo armar?"),r(),i(5,"p",3),n(6,"C\xE1lculo basado en stock actual y recetas activas."),r()(),i(7,"div",4),f(8,Ee,13,3,"div",5,_e,!1,Be,2,0,"div",6),$(11,"async"),r()(),i(12,"section",7)(13,"div",1)(14,"h2",8),n(15,"Simulador de Pedido"),r(),i(16,"p",3),n(17,"Ingresa los productos que deseas armar para verificar disponibilidad de materiales."),r()(),i(18,"div",9)(19,"div",10)(20,"div",11)(21,"form",12),M("ngSubmit",function(){return l.onSimulate()}),i(22,"div",13),f(23,we,15,1,"div",14,V),r(),i(25,"div",15)(26,"button",16),M("click",function(){return l.addItem()}),n(27," + A\xF1adir Producto "),r(),i(28,"button",17),n(29," Simular Pedido "),r()()()()(),i(30,"div",18),y(31,Te,13,6,"div",19),$(32,"async"),U(33,Oe,5,0,"div",20),r()()()()),e&2){let d;o(8),v(j(11,4,l.results$)),o(13),B("formGroup",l.simulationForm),o(2),v(l.items.controls),o(5),B("disabled",l.simulationForm.invalid),o(3),E((d=j(32,6,l.simulationResult$))?31:33,d)}},dependencies:[J,ce,ee,oe,de,K,te,le,X,Z,se,ne,ae,ie,re,Y],encapsulation:2})};var et=[{path:"",component:O}];export{et as BUILD_ROUTES};
